!function(){function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var i=0;i<t.length;i++){var c=t[i];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(e,c.key,c)}}function i(e,i,c){return i&&t(e.prototype,i),c&&t(e,c),e}function c(){var e=o(['\n  mutation UpdateBulkCheckOutVisits($placeUUIDEquals: uuid = "") {\n    update_visit(where: { place_uuid: { _eq: $placeUUIDEquals } }, _set: { checked_out_at: "now()" }) {\n      affected_rows\n      returning {\n        visit_uuid\n        checked_out_at\n        visitor {\n          visitor_uuid\n          visitor_first_name\n        }\n      }\n    }\n  }\n']);return c=function(){return e},e}function n(){var e=o(['\n  subscription PlaceVisitors(\n    $placeUUIDEquals: uuid! = "875b4319-5b1c-44ef-9950-bc6004c4f77a"\n    $checkedInGreaterThan: timestamptz! = "now()"\n  ) {\n    place(where: { place_uuid: { _eq: $placeUUIDEquals } }) {\n      visits_aggregate(where: { place_uuid: { _eq: $placeUUIDEquals }, checked_in_at: { _gte: $checkedInGreaterThan } }) {\n        aggregate {\n          count(columns: visitor_uuid)\n        }\n      }\n      visits(\n        order_by: { checked_in_at: desc_nulls_first, checked_out_at: desc_nulls_first }\n        limit: 300\n        where: { place_uuid: { _eq: $placeUUIDEquals }, checked_in_at: { _gte: $checkedInGreaterThan } }\n      ) {\n        checked_in_at\n        checked_out_at\n        visitor {\n          visitor_uuid\n          visitor_first_name\n          visitor_last_name\n          visitor_phone\n          visitor_email\n        }\n      }\n    }\n  }\n']);return n=function(){return e},e}function o(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{wFkS:function(t,o,a){"use strict";a.r(o),a.d(o,"VisitorsListPageModule",(function(){return L}));var s,r=a("SVse"),u=a("s7LF"),l=a("sZkV"),b=a("iInd"),d=a("pLZG"),v=a("lJxs"),p=a("vkgz"),f=a("IzEk"),h=a("8Y7J"),k=a("9Ku7"),_=a("apZm"),g=a("ALmS"),O=a("eueu"),m=a("nbgS"),I=g.gql(n()),U=g.gql(c()),y=((s=function(){function t(i){e(this,t),this.apollo=i}return i(t,[{key:"getVisitorsByPlaceUUID",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object(O.d)();return this.apollo.subscribe({query:I,variables:{placeUUIDEquals:e,checkedInGreaterThan:t}})}},{key:"filterVisitsNotCheckedOut",value:function(e){return e.filter((function(e){return!e.checked_out_at}))}},{key:"updateBulkCheckOut",value:function(e){console.log("PlaceAdminService:: updateBulkCheckOut()",e);var t=this.apollo.mutate({mutation:U,variables:{placeUUIDEquals:e}});return t.pipe(Object(p.a)((function(e){console.log("updateBulkCheckOut a",e)}))),t}}]),t}()).\u0275fac=function(e){return new(e||s)(h.Tb(m.b))},s.\u0275prov=h.Gb({token:s,factory:s.\u0275fac,providedIn:"root"}),s);function w(e,t){if(1&e&&(h.Nb(0),h.Lb(1,"ion-icon",7),h.sc(2),h.Mb()),2&e){var i=t.$implicit;h.Ab(2),h.uc(" ",i.visits_aggregate.aggregate.count," visitors ")}}function P(e,t){if(1&e&&(h.Nb(0),h.qc(1,w,3,1,"ng-container",5),h.cc(2,"async"),h.Mb()),2&e){var i=h.bc(2);h.Ab(1),h.hc("ngForOf",h.dc(2,1,i.place))}}function C(e,t){if(1&e&&(h.Pb(0,"ion-list-header"),h.qc(1,P,3,3,"ng-container",4),h.cc(2,"async"),h.Ob()),2&e){var i=h.bc();h.Ab(1),h.hc("ngIf",null!==h.dc(2,1,i.place))}}function q(e,t){if(1&e){var i=h.Qb();h.Pb(0,"ion-item-option",12),h.Xb("click",(function(e){h.nc(i);var t=h.bc().$implicit;return h.bc().clickCheckOut(e,t.visitor.visitor_uuid,t.checked_in_at)})),h.sc(1," Check out "),h.Ob()}}function D(e,t){if(1&e&&(h.Pb(0,"ion-item-sliding"),h.Pb(1,"ion-item-options"),h.qc(2,q,2,0,"ion-item-option",8),h.Ob(),h.Pb(3,"ion-item",9),h.Pb(4,"ion-label",10),h.Pb(5,"span",11),h.sc(6),h.cc(7,"date"),h.cc(8,"date"),h.Ob(),h.Pb(9,"h2"),h.sc(10),h.Ob(),h.Pb(11,"h3"),h.sc(12),h.Ob(),h.Ob(),h.Ob(),h.Ob()),2&e){var i=t.$implicit;h.Ab(2),h.hc("ngIf",!i.checked_out_at),h.Ab(2),h.ic("color",i.checked_out_at?"success":"warning"),h.Ab(2),h.vc(" ",h.ec(7,8,i.checked_in_at,"EEEE HH:mm"),"\u2013",h.ec(8,11,i.checked_out_at,"HH:mm")," "),h.Ab(4),h.vc(" ",i.visitor.visitor_first_name," ",i.visitor.visitor_last_name," "),h.Ab(2),h.vc(" ",i.visitor.visitor_phone," ",i.visitor.visitor_email," ")}}var j,A,E,V=[{path:"",component:(j=function(){function t(i,c,n,o){e(this,t),this.activatedRoute=i,this.authenticationService=c,this.checkInOutService=n,this.placeAdminService=o,this.placeUUID=i.snapshot.paramMap.get("placeUUID"),console.log("VisitorsListPage -> constructor -> this.placeUUID",this.placeUUID);var a=o.getVisitorsByPlaceUUID(this.placeUUID);this.placeVisitorsResult=a;var s=a.pipe(Object(d.a)((function(e){var t,i;return void 0!==(null===(i=null===(t=e.data)||void 0===t?void 0:t.place)||void 0===i?void 0:i[0])})),Object(v.a)((function(e){return e.data.place})));this.place=s;var r=s.pipe(Object(v.a)((function(e){return e[0].visits})));this.visits=r}return i(t,[{key:"ngOnInit",value:function(){}},{key:"clickCheckOut",value:function(e,t,i){if(console.log("clickCheckOut -> event",e),void 0!==t&&void 0!==i){var c=this.checkInOutService.updateCheckOutVisitor(this.placeUUID,t,i);console.log("VisitorsListPage -> clickCheckOut -> checkedOutObs",c),c.subscribe((function(e){var t,i=e.data,c=e.errors,n=e.context,o=e.extensions;console.log("clickCheckOut -> data",i,c,n,o);var a=new Date(null===(t=null==i?void 0:i.update_visit_by_pk)||void 0===t?void 0:t.checked_out_at);console.log("VisitorsListPage -> clickCheckOut -> checkedOutDateTime",a)}))}}},{key:"clickBulkCheckOut",value:function(e,t){this.placeAdminService.updateBulkCheckOut(t).pipe(Object(p.a)((function(e){console.log("bulkCheckOut",e)})),Object(d.a)((function(e){var t,i,c,n;return null!==(null===(i=null===(t=e.data)||void 0===t?void 0:t.update_visit)||void 0===i?void 0:i.affected_rows)&&void 0!==(null===(n=null===(c=e.data)||void 0===c?void 0:c.update_visit)||void 0===n?void 0:n.affected_rows)})),Object(f.a)(1),Object(v.a)((function(e){return e.data.update_visit}))).subscribe()}}]),t}(),j.\u0275fac=function(e){return new(e||j)(h.Kb(b.a),h.Kb(k.a),h.Kb(_.a),h.Kb(y))},j.\u0275cmp=h.Eb({type:j,selectors:[["app-visitors-list"]],decls:21,vars:19,consts:[["horizontal","start","vertical","bottom","slot","fixed","size","large"],["color","cobaltbluemonochrome",3,"click"],["name","copy-outline"],["name","log-out-outline"],[4,"ngIf"],[4,"ngFor","ngForOf"],["color","light"],["name","people"],["color","success","button","",3,"click",4,"ngIf"],["button",""],[3,"color"],[2,"float","right"],["color","success","button","",3,"click"]],template:function(e,t){1&e&&(h.Pb(0,"ion-header"),h.Pb(1,"ion-toolbar"),h.Pb(2,"ion-title"),h.sc(3,"List COVIDSafe check ins \u2705 | place visitors"),h.Ob(),h.Ob(),h.Ob(),h.Pb(4,"ion-fab",0),h.Pb(5,"ion-fab-button",1),h.Xb("click",(function(e){return t.clickBulkCheckOut(e,t.placeUUID)})),h.Lb(6,"ion-icon",2),h.Lb(7,"ion-icon",3),h.Ob(),h.Ob(),h.Pb(8,"ion-content"),h.Pb(9,"ion-list"),h.qc(10,C,3,3,"ion-list-header",4),h.qc(11,D,13,14,"ion-item-sliding",5),h.cc(12,"async"),h.Ob(),h.Pb(13,"ion-text",6),h.sc(14),h.cc(15,"json"),h.cc(16,"async"),h.cc(17,"json"),h.cc(18,"async"),h.cc(19,"json"),h.cc(20,"async"),h.Ob(),h.Ob()),2&e&&(h.Ab(10),h.hc("ngIf",t.place),h.Ab(1),h.hc("ngForOf",h.dc(12,5,t.visits)),h.Ab(3),h.wc(" Test 1 ",h.dc(15,7,h.dc(16,9,t.placeVisitorsResult))," 2 ",h.dc(17,11,h.dc(18,13,t.place))," 3 ",h.dc(19,15,h.dc(20,17,t.visits))," "))},directives:[l.m,l.B,l.A,l.j,l.k,l.n,l.i,l.v,r.m,r.l,l.z,l.w,l.t,l.s,l.p,l.u,l.r],pipes:[r.b,r.g,r.e],styles:[""]}),j)}],$=((E=function t(){e(this,t)}).\u0275mod=h.Ib({type:E}),E.\u0275inj=h.Hb({factory:function(e){return new(e||E)},imports:[[b.i.forChild(V)],b.i]}),E),L=((A=function t(){e(this,t)}).\u0275mod=h.Ib({type:A}),A.\u0275inj=h.Hb({factory:function(e){return new(e||A)},imports:[[r.c,u.g,l.C,$]]}),A)}}])}();